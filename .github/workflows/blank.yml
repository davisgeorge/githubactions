name: CI cd
on:
  workflow_dispatch:
    # inputs:
    #   branch:
    #     description: 'The branch to build'
    #     required: true
    #   environment:
    #     description: 'The environment to deploy to'
    #     required: true
      


  # push:
  #   branches:
  #     - main
  #     - release
  #     - test
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout 
        uses: actions/checkout@v3
        with:
          repository: davisgeorge/githubactions
          ref: ${{github.ref}}
          # ref: ${{ github.event.inputs.branch }}
          
            
    
        
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.
          
      - name: Generate Git Tag
        id: generate_tag
        shell: bash
        run: |
          VERSION=""

          #get parameters
          while getopts v: flag
          do
            case "${flag}" in
              v) VERSION=${OPTARG};;
            esac
          done
          CURRENT_VERSION=`git describe --abbrev=0 --tags 2>/dev/null`
          if [[ $CURRENT_VERSION == '' ]]
          then
            CURRENT_VERSION='1.0.0'
          fi
          echo "Current Version: $CURRENT_VERSION"

          # echo "$GITHUB_ACTOR"
          # git config user.name "$GITHUB_ACTOR"
          # git config user.email "github-actions@users.noreply.github.com"
          # git tag -a V2 -m"test tag"
          # git push origin --tags
        #   VERSION_PREFIX="v"

        #   VERSION_MAJOR_MINOR="1.0"

        #   VERSION_PATCH=$(git tag --list
        #   "${VERSION_PREFIX}${VERSION_MAJOR_MINOR}" --sort=-version:refname |
        #   head -n 1 | grep -oE '[0-9]+$')

        #   if [ -z "$VERSION_PATCH" ]; then
        #     VERSION_PATCH=0
        #   else
        #     VERSION_PATCH=$((VERSION_PATCH + 1))
        #   fi

        #   NEW_TAG="${VERSION_PREFIX}${VERSION_MAJOR_MINOR}.${VERSION_PATCH}"

        #   echo "Generated new tag: $NEW_TAG"

        #   echo "NEW_TAG=$NEW_TAG" >> $GITHUB_ENV
  dev-relase:
    name: Deploy-Dev
    if: '${{ github.ref == ''refs/heads/release'' }}'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: release
      - name: this is dev branch
        run: |
          echo "this is dev-relase branch"
          git branch
  dev-test:
    name: Deploy-test
    if: '${{ github.ref == ''refs/heads/test'' }}'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: release
      - name: this is dev branch
        run: |
          echo "this is dev-test branch"
          git branch
